# 3장 컨테이너를 다루는 표준 아키텍처, 쿠버네티스

## 1. 쿠버네티스 이해하기

```
쿠버네티스를 컨테이너 관리 도구라고 설명했지만, 실제로 쿠버네티스는 컨테이너 오케스트레이션을 위한 솔루션이다.
오케스트레이션(Orchestration)이란 복잡한 단계를 관리하고 요소들의 유기적인 관계를 미리 정의해 손쉽게 사용하도록 서비스 제공하는 걸 의미.
다수의 컨테이너를 유기적으로 연결, 실행, 종료할 뿐만 아니라 상태를 추적하고 보존하는 등
컨테이너를 안정적으로 사용할 수 있게 만들어주는 것이 컨테이너 오케스트레이션이다.
```

---

### 1) 왜 쿠버네티스일까?

- 대표적인 컨테이너 오케스트레이션 솔루션

  ![8](https://user-images.githubusercontent.com/87686562/152670046-1835772f-d03d-44e4-a44f-f76077455701.jpg)

- Docker Swarm

  ```
  간단하게 설치할 수 있고 사용하기도 용이함. 그러나 그만큼 기능이 다양하지 않아 대규모 환경에 적용하려면 사용자 환경을 변경해야 함.
  따라서 소규모 환경에서는 유용하지만 대규모 환경에서는 잘 사용하지 않음
  ```

- Mesos

  ```
  Apache의 오픈 소스 프로젝트로 역사와 전통이 있는 클러스터 도구이며 트위터, 에어비앤비, 애플, 우버 등 다양한 곳에서 이미 검증된 솔루션.
  메소스는 2016년 DC/OS(Data Center OS, 대규모 서버 환경에서 자원을 유연하게 공유하며 하나의 자원처럼 관리하는 도구)의 지원으로 매우 간결해짐.
  하지만 기능을 충분히 활용하려면 분산 관리 시스템과 연동해야 함. 따라서 여러 가지 솔루션을 유기적으로 구성해야 하는 부담이 있음.
  ```

- Nomad

  ```
  베이그런트를 만든 HashiCorp사의 컨테이너 오케스트레이션.
  베이그런트처럼 간단한 구성으로 컨테이너 오케스트레이션 환경을 제공함.
  하지만 도커 스웜과 마찬가지로 기능이 부족하므로
  복잡하게 여러 기능을 사용하는 환경이 아닌 가볍고 간단한 기능만 필요한 환경에서 사용을 권장.
  HashiCorp의 Consul(서비스 검색, 구성 및 분할 기능 제공)과 Vault(암호화 저장소)와의 연동이 원할하므로
  이런 도구에 대한 사용 성숙도가 높은 조직이라면 Nomad 도입을 고려해볼 수 있다.
  ```

- Kubernetes

  ```
  다른 오케스트레이션 솔루션보다는 시작하는 데 어려움이 있지만, 쉽게 사용할 수 있도록 도와주는 도구들이 있어서 설치가 쉬워지는 추세.
  또한 다양한 형태의 쿠버네티스가 지속적으로 계속 발전되고 있어서 컨테이너 오케스트레이션을 넘어 IT 인프라 자체를 컨테이너화하고,
  컨테이너화된 인프라 제품군을 쿠버네티스 위에서 동작할 수 있게 만듦.
  즉 거의 모든 벤더와 오픈 소스 진영 모두에서 쿠버네티스를 지원하고 그에 맞게 통합 개발하고 있다.
  그러므로 컨테이너 오케스트레이션을 학습하거나 도입하려고 한다면 쿠버네티스를 우선적으로 고려해야 한다.
  ```

- 컨테이너 오케스트레이션 솔루션 비교

  | 구분           | 도커 스웜     | 메소스      | 노매드    | 쿠버네티스    |
  | -------------- | ------------- | ----------- | --------- | ------------- |
  | 설치 난이도    | 쉬움          | 매우 어려움 | 쉬움      | 어려움        |
  | 사용 편의성    | 매우 좋음     | 좋음        | 매우 좋음 | 좋음          |
  | 세부 설정 지원 | 거의 없음     | 있음        | 거의 없음 | 다양하게 있음 |
  | 안정성         | 매우 안정적임 | 안정적임    | 안정적임  | 매우 안정적임 |
  | 확장성         | 어려움        | 매우 잘 됨  | 어려움    | 매우 잘 됨    |
  | 정보량         | 많음          | 적음        | 적음      | 매우 많음     |
  | 에코 파트너    | 없음          | 거의 없음   | 있음      | 매우 많음     |
  | 학습 곡선      | 쉬움          | 매우 어려움 | 어려움    | 어려움        |

---

### 2) 쿠버네티스 구성 방법

```
1. 퍼블릭 클라우드 업체에서 제공하는 관리형 쿠버네티스인 EKS(Amazon Elastic Kubernetes Service),
   AKS(Azure Kubernetes Services), GKE(Goggle Kubernetes Engine) 등을 사용한다.
   구성이 이미 다 갖춰져 있고 마스터 노드를 클라우드 업체에서 관리하기 때문에 학습용으로는 적합하지 않음.

2. 플랫폼 업체에서 제공하는 Suse의 Rancher, Red hat의 Openshift와 같은 설치형 쿠버네티스를 사용한다.
   하지만 유료라 쉽게 접근하기 어렵다.
   
3. 사용하는 시스템에 쿠버네티스 클러스터를 자동으로 구성해주는 솔루션을 사용한다.
   주요 솔루션으로는 kubeadm, kops(Kubernetes Operations), KRIB(Kubernetes Rebar Integrated Bootstrap),
   kubespray가 있다. 4가지의 주요 솔루션 중에 kubeadm이 가장 널리 알려져 있다.
   kubeadm은 사용자가 변경하기도 수월하고, 온프레미스(On-Premises)와 클라우드를 모두 지원하며, 배우기도 쉽다.
   이러한 솔루션들을 구성형 쿠버네티스라고 함.
```

- 쿠버네티스 클러스터 구성 솔루션 비교

  | 구분            | KRIB        | kops      | kubespray         | kubeadm           |
  | --------------- | ----------- | --------- | ----------------- | ----------------- |
  | 정보량          | 적음        | 많음      | 많음              | 매우 많음         |
  | 세부 설정 변경  | 가능함      | 가능함    | 제한적으로 가능함 | 다양함            |
  | 사전 요구 조건  | 적음        | 적음      | 적음              | 매우 적음         |
  | 온프레미스 지원 | 매우 좋음   | 안 됨     | 좋음              | 매우 좋음         |
  | 클라우드 지원   | 안 됨       | 매우 좋음 | 좋음              | 좋음              |
  | 학습 곡선       | 매우 어려움 | 어려움    | 쉬움              | 어려움            |
  | 자동화 기능     | 제공됨      | 제공됨    | 쉽게 제공됨       | 제한적으로 제공됨 |

---

### 3) 쿠버네티스 구성하기

```
kubeadm으로 구성. 쿠버네티스가 설치되는 서버 노드는 가상 머신을 이용해 실제 온프레미스에 가깝게 구성.
설치되는 과정을 베이그런트로 자오화해 필요하면 쿠버네티스 테스트 환경을 재구성할 수 있게 함.
```



