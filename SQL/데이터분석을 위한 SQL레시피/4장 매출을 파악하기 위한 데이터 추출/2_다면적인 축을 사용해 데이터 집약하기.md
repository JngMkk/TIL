# 다면적인 축을 사용해 데이터 집약하기

```
시계열로 매출 금액의 추이를 표현하는 것 이외에도,
상품 카테고리에 주목해서 매출 내역을 집계하거나 구성하는 비율을 집계하는 등 리포트의 표현 방법은 굉장히 다양함.
매출의 시계열뿐만 아니라 상품의 카테고리, 가격 등을 조합해서 데이터의 특징을 추출해 리포팅하는 방법을 알아보자..

이번 절에서는 EC 사이트를 가정한 데이터.
이 EC 사이트는 한 번 주문으로 여러 상품을 구매할 수 있음.
따라서 하나의 order_id에 여러 정보가 포함되어 있음.
```

- 테이블

  ```sql
  DROP TABLE IF EXISTS purchase_detail_log;
  CREATE TABLE purchase_detail_log(
      dt           varchar(255)
    , order_id     integer
    , user_id      varchar(255)
    , item_id      varchar(255)
    , price        integer
    , category     varchar(255)
    , sub_category varchar(255)
  );
  
  INSERT INTO purchase_detail_log
  VALUES
      ('2017-01-18', 48291, 'usr33395', 'lad533', 37300,  'ladys_fashion', 'bag')
    , ('2017-01-18', 48291, 'usr33395', 'lad329', 97300,  'ladys_fashion', 'jacket')
    , ('2017-01-18', 48291, 'usr33395', 'lad102', 114600, 'ladys_fashion', 'jacket')
    , ('2017-01-18', 48291, 'usr33395', 'lad886', 33300,  'ladys_fashion', 'bag')
    , ('2017-01-18', 48292, 'usr52832', 'dvd871', 32800,  'dvd'          , 'documentary')
    , ('2017-01-18', 48292, 'usr52832', 'gam167', 26000,  'game'         , 'accessories')
    , ('2017-01-18', 48292, 'usr52832', 'lad289', 57300,  'ladys_fashion', 'bag')
    , ('2017-01-18', 48293, 'usr28891', 'out977', 28600,  'outdoor'      , 'camp')
    , ('2017-01-18', 48293, 'usr28891', 'boo256', 22500,  'book'         , 'business')
    , ('2017-01-18', 48293, 'usr28891', 'lad125', 61500,  'ladys_fashion', 'jacket')
    , ('2017-01-18', 48294, 'usr33604', 'mem233', 116300, 'mens_fashion' , 'jacket')
    , ('2017-01-18', 48294, 'usr33604', 'cd477' , 25800,  'cd'           , 'classic')
    , ('2017-01-18', 48294, 'usr33604', 'boo468', 31000,  'book'         , 'business')
    , ('2017-01-18', 48294, 'usr33604', 'foo402', 48700,  'food'         , 'meats')
    , ('2017-01-18', 48295, 'usr38013', 'foo134', 32000,  'food'         , 'fish')
    , ('2017-01-18', 48295, 'usr38013', 'lad147', 96100,  'ladys_fashion', 'jacket')
   ;
  ```

## 1. 카테고리별 매출과 소계 계산하기

> UNION ALL 구문, ROLLUP 구문

